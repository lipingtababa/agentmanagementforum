---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import ArticleCard from '../components/ArticleCard.astro';

const allArticles = await getCollection('articles', ({ data }) => {
  return import.meta.env.PROD ? !data.draft : true;
});

const articles = allArticles.sort(
  (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);

const authors = await getCollection('authors');
const authorMap = new Map(authors.map((a) => [a.id, a.data.name]));
---

<BaseLayout
  title="Agent Management Forum"
  description="Community-driven insights on AI agent orchestration, governance, and management."
>
  <section class="mb-12">
    <h1 class="text-3xl font-bold tracking-tight text-[var(--color-text-primary)] sm:text-4xl">
      Agent Management Forum
    </h1>
    <p class="mt-4 text-lg text-[var(--color-text-secondary)]">
      Community-driven insights on AI agent orchestration, governance, and
      management. Articles contributed by practitioners building with AI agents
      in production.
    </p>
  </section>

  <section>
    <h2 class="mb-6 text-xl font-semibold text-[var(--color-text-primary)]">
      Latest Articles
    </h2>
    <div class="space-y-6">
      {articles.map((article) => (
        <ArticleCard
          article={article}
          authorName={authorMap.get(article.data.author.id) ?? 'Unknown'}
        />
      ))}
    </div>
  </section>
</BaseLayout>
